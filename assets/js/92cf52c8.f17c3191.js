"use strict";(self.webpackChunkdocu=self.webpackChunkdocu||[]).push([[230],{30601:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var n=r(87462),o=(r(67294),r(3905));const i={},a="Partitioning",s={unversionedId:"connector-development/connector-builder-ui/partitioning",id:"connector-development/connector-builder-ui/partitioning",title:"Partitioning",description:"Partitioning is required if the records of a stream are grouped into buckets based on an attribute or parent resources that need to be queried separately to extract the records.",source:"@site/../docs/connector-development/connector-builder-ui/partitioning.md",sourceDirName:"connector-development/connector-builder-ui",slug:"/connector-development/connector-builder-ui/partitioning",permalink:"/connector-development/connector-builder-ui/partitioning",draft:!1,editUrl:"https://github.com/airbytehq/airbyte/blob/master/docs/../docs/connector-development/connector-builder-ui/partitioning.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"Incremental sync",permalink:"/connector-development/connector-builder-ui/incremental-sync"},next:{title:"Error Handling",permalink:"/connector-development/connector-builder-ui/error-handling"}},l={},p=[{value:"Dynamic and static partition routing",id:"dynamic-and-static-partition-routing",level:2},{value:"List partition router",id:"list-partition-router",level:3},{value:"Example",id:"example",level:4},{value:"Substream partition router",id:"substream-partition-router",level:3},{value:"Example",id:"example-1",level:4},{value:"Multiple partition routers",id:"multiple-partition-routers",level:2},{value:"Adding the partition value to the record",id:"adding-the-partition-value-to-the-record",level:2},{value:"Custom parameter injection",id:"custom-parameter-injection",level:2}],u={toc:p},c="wrapper";function d(e){let{components:t,...r}=e;return(0,o.kt)(c,(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"partitioning"},"Partitioning"),(0,o.kt)("p",null,"Partitioning is required if the records of a stream are grouped into buckets based on an attribute or parent resources that need to be queried separately to extract the records."),(0,o.kt)("p",null,"Sometimes records belonging to a single stream are partitioned into subsets that need to be fetched separately. In most cases, these partitions are a parent resource type of the resource type targeted by the connector. The partitioning feature can be used to configure your connector to iterate through all partitions. In API documentation, this concept can show up as mandatory parameters that need to be set on the path, query parameters or request body of the request. "),(0,o.kt)("p",null,"Common API structures look like this:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("a",{parentName:"li",href:"https://developers.surveysparrow.com/rest-apis/response#getV3Responses"},"SurveySparrow API")," allows to fetch a list of responses to surveys. For the ",(0,o.kt)("inlineCode",{parentName:"li"},"/responses")," endpoint, the id of the survey to fetch responses for needs to be specified via the query parameter ",(0,o.kt)("inlineCode",{parentName:"li"},"survey_id"),". The API does not allow to fetch responses for all available surveys in a single request, there needs to be a separate request per survey. The surveys represent the partitions of the responses stream."),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("a",{parentName:"li",href:"https://woocommerce.github.io/woocommerce-rest-api-docs/#order-notes"},"Woocommerce API")," includes an endpoint to fetch notes of webshop orders via the ",(0,o.kt)("inlineCode",{parentName:"li"},"/orders/<id>/notes")," endpoint. The ",(0,o.kt)("inlineCode",{parentName:"li"},"<id>")," placeholder needs to be set to the id of the order to fetch the notes for. The orders represent the partitions of the notes stream.")),(0,o.kt)("p",null,"There are some cases that require multiple requests to fetch all records as well, but partitioning is not the right tool to configure these in the connector builder:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"If your records are spread out across multiple pages that need to be requested individually if there are too many records, use the Pagination feature."),(0,o.kt)("li",{parentName:"ul"},"If your records are spread out over time and multiple requests are necessary to fetch all data (for example one request per day), use the Incremental sync feature.")),(0,o.kt)("h2",{id:"dynamic-and-static-partition-routing"},"Dynamic and static partition routing"),(0,o.kt)("p",null,"There are three possible sources for the partitions that need to be queried - the connector itself, supplied by the end user when configuring a Source based on the connector, or the API  provides the list of partitions on another endpoint (for example the Woocommerce API also includes an ",(0,o.kt)("inlineCode",{parentName:"p"},"/orders")," endpoint that returns all orders)."),(0,o.kt)("p",null,'The first two options are a "static" form of partition routing (because the partitions won\'t change as long as the Airbyte configuration isn\'t changed). The API providing the partitions via one or multiple separate requests is a "dynamic" form of partition routing because the partitions can change any time.'),(0,o.kt)("h3",{id:"list-partition-router"},"List partition router"),(0,o.kt)("p",null,'To configure static partitioning, choose the "List" method for the partition router. The following fields have to be configured:'),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'The "partition values" can either be set to a list of strings, making the partitions part of the connector itself or delegated to a user input so the end user configuring a Source based on the connector can control which partitions to fetch. When using "user input" mode for the partition values, create a user input of type array and reference it as the value using the ',(0,o.kt)("a",{parentName:"li",href:"/connector-development/config-based/understanding-the-yaml-file/reference#variables"},"placeholder")," value using ",(0,o.kt)("inlineCode",{parentName:"li"},"{{ config['<your chosen user input name>'] }}")),(0,o.kt)("li",{parentName:"ul"},'The "Current partition value identifier" can be freely choosen and is the identifier of the variable holding the current partition value. It can for example be used in the path of the stream using the ',(0,o.kt)("inlineCode",{parentName:"li"},"{{ stream_partition.<identifier> }}")," syntax."),(0,o.kt)("li",{parentName:"ul"},'The "Inject partition value into outgoing HTTP request" option allows you to configure how to add the current partition value to the requests')),(0,o.kt)("h4",{id:"example"},"Example"),(0,o.kt)("p",null,"To enable static partition routing defined as part of the connector for the ",(0,o.kt)("a",{parentName:"p",href:"https://developers.surveysparrow.com/rest-apis/response#getV3Responses"},"SurveySparrow API")," responses, the list partition router needs to be configured as following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'"Partition values" are set to the list of survey ids to fetch'),(0,o.kt)("li",{parentName:"ul"},'"Current partition value identifier" is set to ',(0,o.kt)("inlineCode",{parentName:"li"},"survey")," (this is not used for this example)"),(0,o.kt)("li",{parentName:"ul"},'"Inject partition value into outgoing HTTP request" is set to ',(0,o.kt)("inlineCode",{parentName:"li"},"request_parameter")," for the field name ",(0,o.kt)("inlineCode",{parentName:"li"},"survey_id"))),(0,o.kt)("p",null,"When partition values were set to ",(0,o.kt)("inlineCode",{parentName:"p"},"123"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"456")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"789"),", the following requests will be executed:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"curl -X GET https://api.surveysparrow.com/v3/responses?survey_id=123\ncurl -X GET https://api.surveysparrow.com/v3/responses?survey_id=456\ncurl -X GET https://api.surveysparrow.com/v3/responses?survey_id=789\n")),(0,o.kt)("p",null,"To enable user-configurable static partitions for the ",(0,o.kt)("a",{parentName:"p",href:"https://woocommerce.github.io/woocommerce-rest-api-docs/#order-notes"},"Woocommerce API")," order notes, the configuration would look like this:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'Set "Partition values" to "User input"'),(0,o.kt)("li",{parentName:"ul"},'In the "Value" input, click the blue user icon and create a new user input'),(0,o.kt)("li",{parentName:"ul"},"Name it ",(0,o.kt)("inlineCode",{parentName:"li"},"Order IDs"),", set type to ",(0,o.kt)("inlineCode",{parentName:"li"},"array")," and click create"),(0,o.kt)("li",{parentName:"ul"},'Set "Current partition value identifier" to ',(0,o.kt)("inlineCode",{parentName:"li"},"order")),(0,o.kt)("li",{parentName:"ul"},'"Inject partition value into outgoing HTTP request" is disabled, because the order id needs to be injected into the path'),(0,o.kt)("li",{parentName:"ul"},'In the general section of the stream configuration, the "Path URL" is set to ',(0,o.kt)("inlineCode",{parentName:"li"},"/orders/{{ stream_partition.order }}/notes"))),(0,o.kt)("p",null,"When order IDs were set to ",(0,o.kt)("inlineCode",{parentName:"p"},"123"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"456")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"789")," in the testing values, the following requests will be executed:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"curl -X GET https://example.com/wp-json/wc/v3/orders/123/notes\ncurl -X GET https://example.com/wp-json/wc/v3/orders/456/notes\ncurl -X GET https://example.com/wp-json/wc/v3/orders/789/notes\n")),(0,o.kt)("h3",{id:"substream-partition-router"},"Substream partition router"),(0,o.kt)("p",null,'To fetch the list of partitions (in this example surveys or orders) from the API itself, the "Substream" partition router has to be used. It allows you to select another stream of the same connector to serve as the source for partitions to fetch. Each record of the parent stream is used as a partition for the current stream.'),(0,o.kt)("p",null,"The following fields have to be configured to use the substream partition router:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'The "Parent stream" defines the records of which stream should be used as partitions'),(0,o.kt)("li",{parentName:"ul"},'The "Parent key" is the property on the parent stream record that should become the partition value (in most cases this is some form of id)'),(0,o.kt)("li",{parentName:"ul"},'The "Current partition value identifier" can be freely choosen and is the identifier of the variable holding the current partition value. It can for example be used in the path of the stream using the ',(0,o.kt)("inlineCode",{parentName:"li"},"{{ stream_partition.<identifier> }}")," ",(0,o.kt)("a",{parentName:"li",href:"/connector-development/config-based/understanding-the-yaml-file/reference#variables"},"interpolation placeholder"),".")),(0,o.kt)("h4",{id:"example-1"},"Example"),(0,o.kt)("p",null,"To enable dynamic partition routing for the ",(0,o.kt)("a",{parentName:"p",href:"https://woocommerce.github.io/woocommerce-rest-api-docs/#order-notes"},"Woocommerce API"),' order notes, first an "orders" stream needs to be configured for the ',(0,o.kt)("inlineCode",{parentName:"p"},"/orders")," endpoint to fetch a list of orders. Once this is done, the partition router for responses has be configured like this:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'"Parent key" is set to ',(0,o.kt)("inlineCode",{parentName:"li"},"id")),(0,o.kt)("li",{parentName:"ul"},'"Current partition value identifier" is set to ',(0,o.kt)("inlineCode",{parentName:"li"},"order")),(0,o.kt)("li",{parentName:"ul"},'In the general section of the stream configuration, the "Path URL" is set to ',(0,o.kt)("inlineCode",{parentName:"li"},"/orders/{{ stream_partition.order }}/notes"))),(0,o.kt)("p",null,"When triggering a sync, the connector will first fetch all records of the orders stream. The records will look like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{ "id": 123, "currency": "EUR", "shipping_total": "12.23", ... }\n{ "id": 456, "currency": "EUR", "shipping_total": "45.56", ... }\n{ "id": 789, "currency": "EUR", "shipping_total": "78.89", ... }\n')),(0,o.kt)("p",null,'To turn a record into a partition value, the "parent key" is extracted, resulting in the partition values ',(0,o.kt)("inlineCode",{parentName:"p"},"123"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"456")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"789"),". In turn, this results in the following requests to fetch the records of the notes stream:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"curl -X GET https://example.com/wp-json/wc/v3/orders/123/notes\ncurl -X GET https://example.com/wp-json/wc/v3/orders/456/notes\ncurl -X GET https://example.com/wp-json/wc/v3/orders/789/notes\n")),(0,o.kt)("h2",{id:"multiple-partition-routers"},"Multiple partition routers"),(0,o.kt)("p",null,"It is possible to configure multiple partition routers on a single stream - if this is the case, all possible combinations of partition values are requested separately."),(0,o.kt)("p",null,"For example, the ",(0,o.kt)("a",{parentName:"p",href:"https://developers.google.com/speed/docs/insights/v5/reference/pagespeedapi/runpagespeed"},"Google Pagespeed API"),' allows to specify the URL and the "strategy" to run an analysis for. To allow a user to trigger an analysis for multiple URLs and strategies at the same time, two list partition routers can be used (one injecting the partition value into the ',(0,o.kt)("inlineCode",{parentName:"p"},"url")," parameter, one injecting it into the ",(0,o.kt)("inlineCode",{parentName:"p"},"strategy")," parameter)."),(0,o.kt)("p",null,"If a user configures the URLs ",(0,o.kt)("inlineCode",{parentName:"p"},"example.com")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"example.org")," and the strategies ",(0,o.kt)("inlineCode",{parentName:"p"},"desktop")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"mobile"),", then the following requests will be triggered"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"curl -X GET https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=example.com&strategy=desktop\ncurl -X GET https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=example.com&strategy=mobile\ncurl -X GET https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=example.org&strategy=desktop\ncurl -X GET https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=example.org&strategy=mobile\n")),(0,o.kt)("h2",{id:"adding-the-partition-value-to-the-record"},"Adding the partition value to the record"),(0,o.kt)("p",null,"Sometimes it's helpful to attach the partition a record belongs to to the record itself so it can be used during analysis in the destination. This can be done using a transformation to add a field and the ",(0,o.kt)("inlineCode",{parentName:"p"},"{{ stream_partition.<identifier> }}")," interpolation placeholder."),(0,o.kt)("p",null,"For example when fetching the order notes via the ",(0,o.kt)("a",{parentName:"p",href:"https://woocommerce.github.io/woocommerce-rest-api-docs/#order-notes"},"Woocommerce API"),", the order id itself is not included in the note record, which means it won't be possible to associate which note belongs to which order:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{ "id": 999, "author": "Jon Doe", "note": "Great product!" }\n')),(0,o.kt)("p",null,"However the order id can be added by taking the following steps:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'Making sure the "Current partition value identifier" is set to ',(0,o.kt)("inlineCode",{parentName:"li"},"order")),(0,o.kt)("li",{parentName:"ul"},'Add an "Add field" transformation with "Path" ',(0,o.kt)("inlineCode",{parentName:"li"},"order_id"),' and "Value" ',(0,o.kt)("inlineCode",{parentName:"li"},"{{ stream_partition.order }}"))),(0,o.kt)("p",null,"Using this configuration, the notes record looks like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{ "id": 999, "author": "Jon Doe", "note": "Great product!", "order_id": 123 }\n')),(0,o.kt)("h2",{id:"custom-parameter-injection"},"Custom parameter injection"),(0,o.kt)("p",null,'Using the "Inject partition value into outgoing HTTP request" option in the partitioning form works for most cases, but sometimes the API has special requirements that can\'t be handled this way:'),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The API requires to add a prefix or a suffix to the actual value"),(0,o.kt)("li",{parentName:"ul"},"Multiple values need to be put together in a single parameter"),(0,o.kt)("li",{parentName:"ul"},"The value needs to be injected into the URL path"),(0,o.kt)("li",{parentName:"ul"},"Some conditional logic needs to be applied")),(0,o.kt)("p",null,"To handle these cases, disable injection in the partitioning form and use the generic parameter section at the bottom of the stream configuration form to freely configure query parameters, headers and properties of the JSON body, by using jinja expressions and ",(0,o.kt)("a",{parentName:"p",href:"/connector-development/config-based/understanding-the-yaml-file/reference/#/variables"},"available variables"),". You can also use these variables (like ",(0,o.kt)("inlineCode",{parentName:"p"},"stream_partition"),") as part of the URL path as shown in the Woocommerce example above."))}d.isMDXComponent=!0},3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>m});var n=r(67294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=n.createContext({}),p=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},u=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(r),h=o,m=c["".concat(l,".").concat(h)]||c[h]||d[h]||i;return r?n.createElement(m,a(a({ref:t},u),{},{components:r})):n.createElement(m,a({ref:t},u))}));function m(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=r.length,a=new Array(i);a[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:o,a[1]=s;for(var p=2;p<i;p++)a[p]=r[p];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}h.displayName="MDXCreateElement"}}]);